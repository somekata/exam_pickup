<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>試験問題ピックアップツール</title>
    <link rel="stylesheet" href="style.css" />

    <!-- CSVパーサー -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <!-- docx生成ライブラリ -->
    <script src="https://unpkg.com/docx@8.0.0/build/index.js"></script>
  </head>
  <body>
    <header class="header-flex">
      <div class="head-left">
        <h1>🧪 試験問題ピックアップツール</h1>
        <div class="sub">
          CSVを読み込み → フィルタ検索 → 出題する問題を選択 → 並び順と配点を調整
          → Word出力。<br />
          ブラウザ内で完結します（外部送信なし）。
        </div>
      </div>
      <!-- ▼ 利用ガイド -->
      <div class="head-right">
        <a href="docs/instruction.html" target="_blank" class="guide-btn">
          📘 利用ガイド
        </a>
      </div>
    </header>

    <main class="layout">
      <!-- 左カラム：CSVと問題一覧＋検索 -->
      <section class="panel left">
        <section class="block">
          <h2>① CSVファイルを読み込む</h2>
          <input type="file" id="fileInput" accept=".csv" multiple />
          <label class="opt-label-inline">
            <input type="checkbox" id="optRemoveDuplicate" checked />
            重複question_idを自動で削除する
          </label>

          <div class="note">
            期待する列: question_id / case_id / title / case_text /
            question_text / choice_a〜e / correct / language / difficulty /
            domain1 / domain2
          </div>
        </section>

        <section class="block">
          <h2>② 検索・絞り込み</h2>

          <div class="filter-grid">
            <label class="filter-item">
              キーワード
              <input
                type="text"
                id="filterKeyword"
                class="filter-input"
                placeholder="タイトル・症例・問題文・選択肢から検索"
              />
            </label>

            <label class="filter-item">
              言語
              <input
                type="text"
                id="filterLang"
                class="filter-input"
                placeholder="例: ja / en"
              />
            </label>

            <label class="filter-item">
              ID
              <input
                type="text"
                id="filterID"
                class="filter-input"
                placeholder="question_id部分一致"
              />
            </label>

            <label class="filter-item">
              難易度
              <input
                type="text"
                id="filterDifficulty"
                class="filter-input"
                placeholder="例: 1 / 2 / 3"
              />
            </label>

            <label class="filter-item">
              領域
              <input
                type="text"
                id="filterDomain"
                class="filter-input"
                placeholder="domain1 / domain2 部分一致"
              />
            </label>
          </div>

          <div class="note small">入力すると即時フィルタされます。</div>
        </section>

        <section class="block stretch">
          <h2>③ 問題一覧（チェックで選択／解除）</h2>
          <div id="tableSummary" class="note small" style="margin-bottom: 6px">
            読み込み待ち...
          </div>
          <div class="table-wrapper">
            <table id="questionTable">
              <thead>
                <tr>
                  <th>選択</th>
                  <th>ID</th>
                  <th>言語</th>
                  <th>難易度</th>
                  <th>領域</th>
                  <th>タイトル / 症例 / 問題文</th>
                </tr>
              </thead>
              <tbody>
                <!-- script.jsで挿入 -->
              </tbody>
            </table>
          </div>
        </section>
      </section>

      <!-- 右カラム：選択済み + 並び替え + 出力設定 -->
      <section class="panel right">
        <section class="block">
          <h2>④ 選択中の問題</h2>
          <div
            id="selectedSummary"
            class="note small"
            style="margin-bottom: 6px"
          >
            （未選択）
          </div>
          <div id="stats">
            <div>問題数: <span id="statCount">0</span>問</div>
            <div>合計点: <span id="statTotal">0</span>点</div>
          </div>

          <div id="selectedList" class="selected-list">
            <!-- script.jsで挿入 -->
          </div>

          <div class="note small">
            ↑↓ボタンで並び順を変更できます（この順番がWordに出力されます）
          </div>
        </section>

        <section class="block">
          <h2>⑤ 出力オプション</h2>

          <div class="option-grid">
            <label class="opt-label">
              タイトル（ヘッダーに表示）
              <input
                type="text"
                id="optTitleHeader"
                class="opt-input"
                value="年度 本試験"
              />
            </label>

            <label class="opt-label-inline">
              <input type="checkbox" id="optShowPageNumber" checked />
              ページ番号をフッターに入れる
            </label>

            <label class="opt-label">
              余白
              <select id="optPageMargin" class="opt-input">
                <option value="narrow">せまい</option>
                <option value="normal" selected>ふつう</option>
                <option value="wide">ひろい</option>
              </select>
            </label>

            <label class="opt-label">
              問題番号スタイル
              <select id="optQuestionNumberStyle" class="opt-input">
                <option value="mondai" selected>問題1</option>
                <option value="dai">第1問</option>
                <option value="numdot">1.</option>
                <option value="paren">(1)</option>
                <option value="qnum">Q1.</option>
              </select>
            </label>

            <label class="opt-label">
              選択肢ラベル
              <select id="optChoiceLabelStyle" class="opt-input">
                <option value="123" selected>1. / 2. / 3.</option>
                <option value="abc">a. / b. / c.</option>
                <option value="ABC">A. / B. / C.</option>
              </select>
            </label>

            <label class="opt-label-inline">
              <input type="checkbox" id="optShowScore" checked />
              各設問の配点を印字する
            </label>

            <label class="opt-label">
              配点の表示位置
              <select id="optScorePosition" class="opt-input">
                <option value="end" selected>問題文の最後に (... [2])</option>
                <option value="header">問題番号の横に (Q1[2]...)</option>
              </select>
            </label>

            <label class="opt-label-inline">
              <input type="checkbox" id="optIncludeChoices" checked />
              選択肢を表示する
            </label>

            <label class="opt-label-inline">
              <input type="checkbox" id="optIncludeTitle" />
              タイトルを表示する
            </label>

            <label class="opt-label-inline">
              <input type="checkbox" id="optIncludeMeta" />
              メタ情報(難易度/領域/言語)を表示する
            </label>

            <label class="opt-label-inline">
              <input type="checkbox" id="optShowAnswer" />
              正解を表示する（解答つき版）
            </label>

            <div class="opt-inline-row">
              <label class="opt-sub">
                解答の色
                <select id="optAnswerColor" class="opt-input small">
                  <option value="000000">黒</option>
                  <option value="FF0000" selected>赤</option>
                  <option value="0000FF">青</option>
                </select>
              </label>

              <label class="opt-sub-inline">
                <input type="checkbox" id="optAnswerBold" checked />
                太字
              </label>

              <label class="opt-sub-inline">
                <input type="checkbox" id="optAnswerUnderline" />
                下線
              </label>
            </div>

            <div class="opt-inline-row">
              <label class="opt-sub">
                本文フォント
                <select id="optFontFamilyQuestion" class="opt-input small">
                  <option value="Yu Gothic" selected>游ゴシック系</option>
                  <option value="Meiryo">メイリオ</option>
                  <option value="MS Mincho">MS明朝系</option>
                  <option value="Times New Roman">Times New Roman</option>
                  <option value="Arial">Arial</option>
                </select>
              </label>

              <label class="opt-sub">
                本文サイズ(pt)
                <select id="optFontSizeQuestion" class="opt-input small">
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11" selected>11</option>
                  <option value="12">12</option>
                </select>
              </label>
            </div>

            <div class="opt-inline-row">
              <label class="opt-sub">
                選択肢フォント
                <select id="optFontFamilyChoices" class="opt-input small">
                  <option value="Yu Gothic" selected>游ゴシック系</option>
                  <option value="Meiryo">メイリオ</option>
                  <option value="MS Mincho">MS明朝系</option>
                  <option value="Times New Roman">Times New Roman</option>
                  <option value="Arial">Arial</option>
                </select>
              </label>

              <label class="opt-sub">
                選択肢サイズ(pt)
                <select id="optFontSizeChoices" class="opt-input small">
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11" selected>11</option>
                  <option value="12">12</option>
                </select>
              </label>
            </div>
          </div>

          <div class="export-zone">
            <button id="exportDocx" class="export-btn">
              Wordファイル（.docx）出力
            </button>
          </div>
        </section>
      </section>
    </main>

    <footer>
      <small>ver 0.6 / exam_pickup</small>
    </footer>

    <script src="script.js"></script>
    <button id="backToTopBtn" type="button" title="ページの先頭へ">TOP</button>
    <script src="topbutton.js"></script>
  </body>
</html>
